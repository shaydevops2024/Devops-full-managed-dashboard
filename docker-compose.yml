services:

  mongodb:

    image: mongo:7.0

    container_name: devops-mongodb

    restart: unless-stopped

    environment:

      MONGO_INITDB_DATABASE: devops-platform

    ports:

      - "27017:27017"

    volumes:

      - mongodb_data:/data/db

    networks:

      - devops-network



  backend:

    build:

      context: ./backend

      dockerfile: Dockerfile

    container_name: devops-backend

    restart: unless-stopped

    ports:

      - "5000:5000"

    environment:

      - NODE_ENV=production

      - PORT=5000

      - MONGODB_URI=mongodb://mongodb:27017/devops-platform

      - JWT_SECRET=your-super-secret-jwt-key-change-this-in-production-12345

      - JWT_EXPIRE=7d

      - ALLOWED_ORIGINS=*

      - PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/host/usr/local/bin:/host/usr/bin:/host/snap/bin

      - GENERATOR_BASE_PATH=/generator

    volumes:

      - ./backend/uploads:/app/uploads

      - ./backend/logs:/app/logs

      - /var/run/docker.sock:/var/run/docker.sock

      - /usr/local/bin:/host/usr/local/bin:ro

      - /usr/bin:/host/usr/bin:ro

      - /snap/bin:/host/snap/bin:ro

      - ${HOME}/Generator:/generator

    depends_on:

      - mongodb

    networks:

      - devops-network



  frontend:

    build:

      context: ./frontend

      dockerfile: Dockerfile

    container_name: devops-frontend

    restart: unless-stopped

    ports:

      - "8082:80"

    depends_on:

      - backend

    networks:

      - devops-network



networks:

  devops-network:

    driver: bridge



volumes:

  mongodb_data:

    driver: local